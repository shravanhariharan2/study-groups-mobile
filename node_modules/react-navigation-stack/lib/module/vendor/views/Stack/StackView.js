import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";import _extends from"@babel/runtime/helpers/extends";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _possibleConstructorReturn from"@babel/runtime/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime/helpers/getPrototypeOf";import _inherits from"@babel/runtime/helpers/inherits";var _jsxFileName="/Users/satya/Workspace/Callstack/react-navigation-stack/src/vendor/views/Stack/StackView.tsx";import*as React from'react';import{Platform}from'react-native';import{SafeAreaConsumer}from'react-native-safe-area-context';import{StackActions,SceneView}from'react-navigation';import CardStack from'./CardStack';import KeyboardManager from'../KeyboardManager';import HeaderContainer from'../Header/HeaderContainer';import SafeAreaProviderCompat from'../SafeAreaProviderCompat';var StackView=function(_React$Component){_inherits(StackView,_React$Component);function StackView(){var _getPrototypeOf2;var _this;_classCallCheck(this,StackView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(StackView)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={routes:[],previousRoutes:[],previousDescriptors:{},openingRouteKeys:[],closingRouteKeys:[],replacingRouteKeys:[],descriptors:{}};_this.getGesturesEnabled=function(_ref){var route=_ref.route;var descriptor=_this.state.descriptors[route.key];if(descriptor){var _descriptor$options=descriptor.options,gestureEnabled=_descriptor$options.gestureEnabled,animationEnabled=_descriptor$options.animationEnabled;if(animationEnabled===false){return false;}return gestureEnabled!==undefined?gestureEnabled:Platform.OS!=='android';}return false;};_this.getPreviousRoute=function(_ref2){var route=_ref2.route;var _this$state=_this.state,closingRouteKeys=_this$state.closingRouteKeys,replacingRouteKeys=_this$state.replacingRouteKeys;var routes=_this.state.routes.filter(function(r){return r.key===route.key||!closingRouteKeys.includes(r.key)&&!replacingRouteKeys.includes(r.key);});var index=routes.findIndex(function(r){return r.key===route.key;});return routes[index-1];};_this.renderScene=function(_ref3){var route=_ref3.route;var descriptor=_this.state.descriptors[route.key]||_this.props.descriptors[route.key];if(!descriptor){return null;}var navigation=descriptor.navigation,getComponent=descriptor.getComponent;var SceneComponent=getComponent();return React.createElement(SceneView,{screenProps:_this.props.screenProps,navigation:navigation,component:SceneComponent,__source:{fileName:_jsxFileName,lineNumber:271}});};_this.renderHeader=function(props){return React.createElement(HeaderContainer,_extends({},props,{__source:{fileName:_jsxFileName,lineNumber:280}}));};_this.handleTransitionComplete=function(_ref4){var route=_ref4.route;_this.props.navigation.dispatch(StackActions.completeTransition({toChildKey:route.key}));};_this.handleOpenRoute=function(_ref5){var route=_ref5.route;_this.handleTransitionComplete({route:route});_this.setState(function(state){return{routes:state.replacingRouteKeys.length?state.routes.filter(function(r){return!state.replacingRouteKeys.includes(r.key);}):state.routes,openingRouteKeys:state.openingRouteKeys.filter(function(key){return key!==route.key;}),closingRouteKeys:state.closingRouteKeys.filter(function(key){return key!==route.key;}),replacingRouteKeys:[]};});};_this.handleCloseRoute=function(_ref6){var route=_ref6.route;var _this$props=_this.props,state=_this$props.state,navigation=_this$props.navigation;if(state.routes.find(function(r){return r.key===route.key;})){navigation.dispatch(StackActions.pop({key:route.key}));}else{var index=_this.state.routes.findIndex(function(r){return r.key===route.key;});_this.handleTransitionComplete({route:_this.state.routes[Math.max(index-1,0)]});_this.setState(function(state){return{routes:state.routes.filter(function(r){return r.key!==route.key;}),openingRouteKeys:state.openingRouteKeys.filter(function(key){return key!==route.key;}),closingRouteKeys:state.closingRouteKeys.filter(function(key){return key!==route.key;})};});}};_this.handleTransitionStart=function(_ref7,closing){var route=_ref7.route;var descriptors=_this.props.descriptors;var descriptor=descriptors[route.key];descriptor&&descriptor.options.onTransitionStart&&descriptor.options.onTransitionStart({closing:closing});};_this.handleTransitionEnd=function(_ref8,closing){var route=_ref8.route;var descriptors=_this.props.descriptors;var descriptor=descriptors[route.key];descriptor&&descriptor.options.onTransitionStart&&descriptor.options.onTransitionStart({closing:closing});};return _this;}_createClass(StackView,[{key:"render",value:function render(){var _this2=this;var _this$props2=this.props,state=_this$props2.state,navigation=_this$props2.navigation,keyboardHandlingEnabled=_this$props2.keyboardHandlingEnabled,_this$props2$mode=_this$props2.mode,mode=_this$props2$mode===void 0?'card':_this$props2$mode,rest=_objectWithoutProperties(_this$props2,["state","navigation","keyboardHandlingEnabled","mode"]);var _this$state2=this.state,routes=_this$state2.routes,descriptors=_this$state2.descriptors,openingRouteKeys=_this$state2.openingRouteKeys,closingRouteKeys=_this$state2.closingRouteKeys;var headerMode=mode!=='modal'&&Platform.OS==='ios'?'float':'screen';return React.createElement(SafeAreaProviderCompat,{__source:{fileName:_jsxFileName,lineNumber:381}},React.createElement(SafeAreaConsumer,{__source:{fileName:_jsxFileName,lineNumber:382}},function(insets){return React.createElement(KeyboardManager,{enabled:keyboardHandlingEnabled!==false,__source:{fileName:_jsxFileName,lineNumber:384}},function(props){return React.createElement(CardStack,_extends({mode:mode,insets:insets,getPreviousRoute:_this2.getPreviousRoute,getGesturesEnabled:_this2.getGesturesEnabled,routes:routes,openingRouteKeys:openingRouteKeys,closingRouteKeys:closingRouteKeys,onOpenRoute:_this2.handleOpenRoute,onCloseRoute:_this2.handleCloseRoute,onTransitionStart:_this2.handleTransitionStart,onTransitionEnd:_this2.handleTransitionEnd,renderHeader:_this2.renderHeader,renderScene:_this2.renderScene,headerMode:headerMode,state:state,descriptors:descriptors},rest,props,{__source:{fileName:_jsxFileName,lineNumber:386}}));});}));}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){if(props.state.routes===state.previousRoutes&&state.routes.length){if(props.descriptors!==state.previousDescriptors){var _descriptors=state.routes.reduce(function(acc,route){acc[route.key]=props.descriptors[route.key]||state.descriptors[route.key];return acc;},{});return{previousDescriptors:props.descriptors,descriptors:_descriptors};}return null;}var routes=props.state.index<props.state.routes.length-1?props.state.routes.slice(0,props.state.index+1):props.state.routes;var openingRouteKeys=state.openingRouteKeys,closingRouteKeys=state.closingRouteKeys,replacingRouteKeys=state.replacingRouteKeys,previousRoutes=state.previousRoutes;var previousFocusedRoute=previousRoutes[previousRoutes.length-1];var nextFocusedRoute=routes[routes.length-1];if(previousFocusedRoute&&previousFocusedRoute.key!==nextFocusedRoute.key){var isAnimationEnabled=function isAnimationEnabled(route){var descriptor=props.descriptors[route.key]||state.descriptors[route.key];return descriptor?descriptor.options.animationEnabled!==false:true;};if(!previousRoutes.find(function(r){return r.key===nextFocusedRoute.key;})){if(isAnimationEnabled(nextFocusedRoute)&&!openingRouteKeys.includes(nextFocusedRoute.key)){openingRouteKeys=[].concat(_toConsumableArray(openingRouteKeys),[nextFocusedRoute.key]);closingRouteKeys=closingRouteKeys.filter(function(key){return key!==nextFocusedRoute.key;});replacingRouteKeys=replacingRouteKeys.filter(function(key){return key!==nextFocusedRoute.key;});if(!routes.find(function(r){return r.key===previousFocusedRoute.key;})){replacingRouteKeys=[].concat(_toConsumableArray(replacingRouteKeys),[previousFocusedRoute.key]);openingRouteKeys=openingRouteKeys.filter(function(key){return key!==previousFocusedRoute.key;});closingRouteKeys=closingRouteKeys.filter(function(key){return key!==previousFocusedRoute.key;});routes=routes.slice();routes.splice(routes.length-1,0,previousFocusedRoute);}}}else if(!routes.find(function(r){return r.key===previousFocusedRoute.key;})){if(isAnimationEnabled(previousFocusedRoute)&&!closingRouteKeys.includes(previousFocusedRoute.key)){closingRouteKeys=[].concat(_toConsumableArray(closingRouteKeys),[previousFocusedRoute.key]);openingRouteKeys=openingRouteKeys.filter(function(key){return key!==previousFocusedRoute.key;});replacingRouteKeys=replacingRouteKeys.filter(function(key){return key!==previousFocusedRoute.key;});routes=[].concat(_toConsumableArray(routes),[previousFocusedRoute]);}}else{}}else if(replacingRouteKeys.length||closingRouteKeys.length){var _routes;routes=routes.slice();(_routes=routes).splice.apply(_routes,[routes.length-1,0].concat(_toConsumableArray(state.routes.filter(function(_ref9){var key=_ref9.key;return replacingRouteKeys.includes(key)||closingRouteKeys.includes(key);}))));}if(!routes.length){throw new Error("There should always be at least one route.");}var descriptors=routes.reduce(function(acc,route){acc[route.key]=props.descriptors[route.key]||state.descriptors[route.key];return acc;},{});return{routes:routes,previousRoutes:props.state.routes,previousDescriptors:props.descriptors,openingRouteKeys:openingRouteKeys,closingRouteKeys:closingRouteKeys,replacingRouteKeys:replacingRouteKeys,descriptors:descriptors};}}]);return StackView;}(React.Component);export default StackView;
//# sourceMappingURL=StackView.js.map